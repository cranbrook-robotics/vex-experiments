#pragma config(UserModel, "C:/Users/rstudent/code/robot-configs/32B.c")
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

// Always open the debug stream window when the program starts
#pragma DebuggerWindows("debugStream")

#include <CKFlywheelSpeedController.h>


/*_________________________________________________________
 *
 * Robot-specific parameters
 */

const Motor393GearBox FlywheelGearbox = M393Turbo;
const int MotorsPerFlywheel = 2;

//_________________________________________________________






float speedDialValue(){
	return 24*potentiometer(speedDial); //rad/sec of motor output shaft
}


task main(){
	FlywheelSpeedController ctlrL, ctlrR;

	const tMotor motorPortsL[] = {mFlyLF, mFlyLB};
	const tMotor motorPortsR[] = {mFlyRF, mFlyRB};

	const float Kq = 0.05, Ki = 0.01, Kd = 0;

	// 1.2908e0.0602x
	FlywheelSpeedControllerInit( ctlrL, Kq, Ki, Kd, 1.2908, 0.0602, motorPortsL, MotorsPerFlywheel, FlywheelGearbox );
	// 1.4517e0.056x
	FlywheelSpeedControllerInit( ctlrR, Kq, Ki, Kd, 1.4517, 0.0560, motorPortsR, MotorsPerFlywheel, FlywheelGearbox );


	//MovingAverageInit( maBattery, 10 );


	while(true){
		clearTimer(T1);

		float speed = speedDialValue();

		setTargetSpeed( ctlrL, speed );
		setTargetSpeed( ctlrR, speed );
		update( ctlrL );
		update( ctlrR );

		writeDebugStream( "%.2f", MainBatteryVoltage() );
		writeDebugStream( "  |  %.2f \t %.2f \t %.2f", ctlrL.targetSpeed, getAverage( ctlrL.maFlywheelSpeed ), ctlrL.controlPower );
		writeDebugStream( "  |  %.2f \t %.2f \t %.2f", ctlrR.targetSpeed, getAverage( ctlrR.maFlywheelSpeed ), ctlrR.controlPower );
		writeDebugStreamLine("");

		delay( 30 - time1[T1] );
	}
}
