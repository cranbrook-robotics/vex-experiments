#pragma config(UART_Usage, UART2, uartNotUsed, baudRate4800, IOPins, None, None)
#pragma config(Motor,  port1,           mpTest,        tmotorVex393_HBridge, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

// Always open the debug stream window when the program starts
#pragma DebuggerWindows("debugStream")

// Use a floating point number in Volts by default
#define MainBatteryVoltage()	(nAvgBatteryLevel / 1000.0)


const int MaxMotorPower = 127;

struct MotorState {
	int port;
	int power;
	int powerDir;
	long imeTicks;
	float imeVelocity;
};

void updateMotorPower( MotorState& self );

void MotorStateInit( MotorState& self, int port ){
	self.port = port;
	self.power = 0;
	self.powerDir = 1;
	self.imeTicks = 0;
	self.imeVelocity = 0;

	updateMotorPower( self );
}

void updateMotorPower( MotorState& self ){
	motor[ self.port ] = self.power;
}

void nextPower( MotorState& self ){
	if( abs(self.power) >= MaxMotorPower ){
		self.powerDir = -self.powerDir;
	}
	self.power += self.powerDir;

	updateMotorPower( self );
}



task main(){

	MotorState testMotor;
	MotorStateInit( testMotor, mpTest );

	while( true ){
		writeDebugStreamLine("%d", testMotor.power);
		wait1Msec(200);
		nextPower(testMotor);
	}
}
